---
title: "3.Time-Heatmap-GO"
output: html_document
---

#### 1. Load TrendCatcher R package.

```{r, results='hide', message=FALSE}
library(TrendCatcher)
```

#### 2. Now read the demo master.list.

```{r}
demo.master.list.path<-system.file("extdata", "BrainMasterList.rda", package = "TrendCatcher")
load(demo.master.list.path)
```

To run TimeHeatmap function, the master.table must include "Symbol" column with gene symbols.

```{r}
gene.symbol.df<-get_GeneEnsembl2Symbol(ensemble.arr = master.list$master.table$Gene)
master.table.new<-cbind(master.list$master.table, gene.symbol.df[match(master.list$master.table$Gene, gene.symbol.df$Gene), c("Symbol", "description")])
master.list$master.table<-master.table.new
head(master.list$master.table)
```
```{r}
### ONLY use this command if CSV file is using GENE SYMBOL as row name!!!!!!
#master.list$master.table$Symbol<-master.list$master.table$Gene 
```

#### 3. Use GO enrichment analysis to construct Time-Heatmap

To draw Time-Heatmap using GO database, please use draw_TimeHeatmap_GO function. This function will return a list composed of a TimeHeatmap plot and a merge.df dataframe. Due to the limited size of Time-Heatmap for visualization, users can play with merge.df which includes all the GO enrichment analysis for each time window. 

```{r, echo=FALSE, fig.height=15, fig.width=15}
if(FALSE){
time_heatmap<-draw_TimeHeatmap_GO(master.list = master.list, logFC.thres = 0, top.n = 10, dyn.gene.p.thres = 0.05, keyType = "SYMBOL", OrgDb = "org.Mm.eg.db", ont = "BP", term.width = 80, GO.enrich.p = 0.05, figure.title = "TimeHeatmap")  
}
```

The full version of GO enrichment output. 

```{r}
# To save time, directely load from extdata
demo.time.heatmap.path<-system.file("extdata", "Brain_TimeHeatmap.rda", package = "TrendCatcher")
load(demo.time.heatmap.path)
names(time_heatmap)
```


Print out TimeHeatmap from the time_heatmap list object. 
```{r}
print(time_heatmap$time.heatmap)
```

Check all the enriched GO terms. 

```{r}
head(time_heatmap$merge.df)
```

Check top enriched GO terms average log2FC within each time window. 
```{r}
head(time_heatmap$GO.df)
```

#### 4. Time-Heatmap with non-redundant GO terms.

Sometimes GO terms are redundant, users can select manually non-redundant GOs using function below.
```{r}
go.terms<-unique(time_heatmap$GO.df$Description)[1:5]
time_heatmap_selGO<-draw_TimeHeatmap_selGO(time_heatmap = time_heatmap, sel.go = go.terms, master.list = master.list, GO.perc.thres = 0, nDDEG.thres = 0)
print(time_heatmap_selGO$time.heatmap)
```

#### 5. Look at Genes candidates from picked enriched GO terms.

To look at which genes are involved within the TimeHeatmap above. We can call draw_GOHeatmap function. 
This function is useful when one is comparing multiple projects. 

```{r, fig.height=10, fig.width=7}
go.terms<-c("response to lipopolysaccharide",
            "response to interferon-beta",
            "cytokine-mediated signaling pathway",
            "response to interferon-gamma",
            "response to virus",
            "leukocyte migration",
            "mitotic nuclear division",
            "regulation of vasculature development",
            "extracellular structure organization",
            "regulation of epithelial cell proliferation")
gene.GO.df<-draw_GOHeatmap(master.list = master.list, time.window = "0h-6h", 
                           go.terms = go.terms,  merge.df = time_heatmap$merge.df, 
                           logFC.thres = 5)
```

The data.frame gene.GO.df contains all the genes we found through TrendCatcher without logFC threshold.

- type, activation pathway or deactivation pathway.
- Description, GO term.
- gene, gene symbol or gene ensembl.
- logFC.prev.bk, logFC compared to previous break point.
- prev.bk.t, previous break poin time.
- Symbol, gene symbol.
- description, gene description.


```{r}
head(gene.GO.df)
```




























